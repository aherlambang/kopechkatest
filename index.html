<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Email Fetcher</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        .hidden {
            display: none;
        }
        .visible {
            display: block;
        }
    </style>
</head>
<body>
    <h1>Email Fetcher</h1>

    <!-- Dropdown for selecting email provider -->
    <label for="provider-select">Select Email Provider:</label>
    <select id="provider-select">
        <option value="gmail.com">gmail.com</option>
        <option value="icloud">icloud</option>
        <option value="gmx.com">gmx.com</option>
    </select>
    
    <button id="fetch-email-btn">Fetch Email</button>
    
    <div id="email-container" class="hidden">
        <p>Email: <span id="email-display"></span></p>
    </div>

    <div id="code-container" class="hidden">
        <p>Confirmation Code: <span id="code-display"></span></p>
    </div>

    <script>
        const fetchEmailBtn = document.getElementById('fetch-email-btn');
        const emailDisplay = document.getElementById('email-display');
        const codeDisplay = document.getElementById('code-display');
        const emailContainer = document.getElementById('email-container');
        const codeContainer = document.getElementById('code-container');
        const providerSelect = document.getElementById('provider-select');

        let selectedProvider = providerSelect.value;
        let fetchedEmail = '';

        // Fetch email based on the selected provider
        fetchEmailBtn.addEventListener('click', () => {
            selectedProvider = providerSelect.value;
            if (selectedProvider === 'icloud') {
                fetchICloudMail();
            } else {
                fetchKopeechkaEmail(selectedProvider);
            }
        });

        providerSelect.addEventListener('change', () => {
            // Reset email and code displays on provider change
            emailContainer.classList.add('hidden');
            codeContainer.classList.add('hidden');
            emailDisplay.textContent = '';
            codeDisplay.textContent = '';
        });

        function fetchKopeechkaEmail(emailProvider) {
            const url = `https://api.kopeechka.store/mailbox-get-email?site=instagram.com&mail_type=${emailProvider}&token=492cca6f3d079f1b88c7b3eedb35347e`;

            fetch(url)
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'OK') {
                        fetchedEmail = data.mail;
                        emailDisplay.textContent = fetchedEmail;
                        emailContainer.classList.remove('hidden');
                        fetchKopeechkaCode(data.id); // Use the email id to fetch the code
                    } else {
                        alert('Failed to fetch email from Kopeechka provider');
                    }
                })
                .catch(error => console.error('Error fetching email:', error));
        }

        function fetchICloudMail() {
            fetch('http://45.32.107.29:8888/api/rent-mail')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        fetchedEmail = data.email;
                        emailDisplay.textContent = fetchedEmail;
                        emailContainer.classList.remove('hidden');
                        fetchICloudMailCode(fetchedEmail);
                    } else {
                        alert('Failed to fetch email from iCloud provider');
                    }
                })
                .catch(error => console.error('Error fetching iCloud email:', error));
        }

        function fetchKopeechkaCode(id) {
            setInterval(() => {
                fetch(`https://api.kopeechka.store/mailbox-check?id=${id}&token=492cca6f3d079f1b88c7b3eedb35347e`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.status === 'OK' && data.value) {
                            const emailBody = data.value;
                            const code = extractCodeFromBody(emailBody);
                            if (code) {
                                codeDisplay.textContent = code;
                                codeContainer.classList.remove('hidden');
                            }
                  
